- Выбор роли подключения к существующей игре
- Любое сообщение (кроме AnnouncementMsg, DiscoverMsg и AckMsg) подтверждается путём отправки в ответ сообщения AckMsg с таким же msg_seq, как в исходном сообщении.
- Если отправитель не получил такое подтверждение, он переотправляет сообщение через интервал, равный значению параметра state_delay_ms делённому на 10.
- Если мы не отправляли абсолютно никаких unicast-сообщений узлу в течение интервала из предыдущего пункта, то необходимо отправить сообщение PingMsg.
- Если мы не получали абсолютно никаких unicast-сообщений от узла в течение 0.8 * state_delay_ms миллисекунд, то мы считаем что узел выпал из игры.
Тут может быть три ситуации:
- а) Узел с ролью NORMAL заметил, что отвалился MASTER. Тогда он заменяет информацию о центральном узле на заместителя (DEPUTY), т.е начинает посылать все unicast-сообщения в сторону DEPUTY.
- б) Узел с ролью MASTER заметил, что отвалился DEPUTY. Тогда он выбирает нового DEPUTY среди NORMAL-ов, и сообщает об этом самому DEPUTY сообщением RoleChangeMsg (остальные узнают о новом DEPUTY из планового StatusMsg, им это знать не срочно).
- в) Узел с ролью DEPUTY заметил, что отвалился MASTER. Тогда он сам становится MASTER-ом (берёт управление игрой на себя), выбирает нового DEPUTY, и сообщает об этом каждому игроку сообщением RoleChangeMsg.
- Важно, что при смене MASTER-а сообщения, ранее отправленные старому MASTER-у, но ещё не подтверждённые, должны продолжить переотправляться новому MASTER-у.
- Игрок может выйти из игры как по таймауту (см. выше), так и явно с помощью сообщения RoleChangeMsg, указав что желает стать VIEWER-ом.
- В обоих случаях он теряет контроль над своей змейкой, и её SnakeState меняется на ZOMBIE.
- Игра завершается, когда из неё выходит последний игрок (MASTER).

известные баги:
- на клиенте множатся змейки в field.snakes